# User queries
query GetCurrentUser @auth(level: USER) {
  user(key: {id_expr: "auth.uid"}) {
    id
    email
    displayName
    photoUrl
    createdAt
    updatedAt
  }
}

# Vector search queries
query SearchProfilesByBio($searchText: String!, $limit: Int = 5) @auth(level: USER) {
  profiles_bioEmbedding_similarity(
    compare_embed: {model: "textembedding-gecko@003", text: $searchText},
    method: COSINE,
    limit: $limit
  ) {
    id
    userId
    name
    bio
    skills
    interests
    avatarUrl
    _metadata {
      distance
    }
  }
}

query SearchBusinessProfilesByDescription($searchText: String!, $limit: Int = 5) @auth(level: USER) {
  businessProfiles_descriptionEmbedding_similarity(
    compare_embed: {model: "textembedding-gecko@003", text: $searchText},
    method: COSINE,
    limit: $limit
  ) {
    id
    workspaceId
    name
    industry
    description
    location
    website
    employeeCount
    _metadata {
      distance
    }
  }
}

query MatchProfileToBusinesses($profileId: UUID!, $limit: Int = 5) @auth(level: USER) {
  profile(key: {id: $profileId}) {
    id
    name
    bio
    bioEmbedding
  }

  # This query will be executed in the frontend using the retrieved bioEmbedding
  # businessProfiles_descriptionEmbedding_similarity(
  #   compare: $bioEmbedding,
  #   method: COSINE,
  #   limit: $limit
  # )
}

query MatchBusinessToProfiles($businessProfileId: UUID!, $limit: Int = 5) @auth(level: USER) {
  businessProfile(key: {id: $businessProfileId}) {
    id
    name
    description
    descriptionEmbedding
  }

  # This query will be executed in the frontend using the retrieved descriptionEmbedding
  # profiles_bioEmbedding_similarity(
  #   compare: $descriptionEmbedding,
  #   method: COSINE,
  #   limit: $limit
  # )
}

query SearchPartnerPreferences($searchText: String!, $limit: Int = 5) @auth(level: USER) {
  partnerPreferencess_combinedEmbedding_similarity(
    compare_embed: {model: "textembedding-gecko@003", text: $searchText},
    method: COSINE,
    limit: $limit
  ) {
    id
    workspaceId
    industries
    locations
    minEmployeeCount
    maxEmployeeCount
    skillsNeeded
    _metadata {
      distance
    }
  }
}

query GetUser($id: String!) @auth(level: USER) {
  user(key: {id: $id}) {
    id
    email
    displayName
    photoUrl
    createdAt
    updatedAt
  }
}

query GetUserProfiles @auth(level: USER) {
  profiles(where: {userId: {eq_expr: "auth.uid"}}) {
    id
    userId
    name
    bio
    avatarUrl
    skills
    interests
    isDefault
    createdAt
    updatedAt
  }
}

# Workspace queries
query GetUserWorkspaces @auth(level: USER) {
  workspaceMembers(where: {userId: {eq_expr: "auth.uid"}}) {
    workspaceId
    # Note: We can't directly query the workspace relationship
    # We'll need to fetch the workspace separately using the workspaceId
  }
}

query GetWorkspace($id: UUID!) @auth(level: USER) {
  workspace(key: {id: $id}) {
    id
    name
    description
    logoUrl
    createdBy
    createdAt
    updatedAt
  }
}

query GetWorkspaceMembers($workspaceId: UUID!) @auth(level: USER) {
  workspaceMembers(where: {workspaceId: {eq: $workspaceId}}) {
    workspaceId
    userId
    profileId
    role
    joinedAt
    # Note: We can't directly query the user and profile relationships
    # We'll need to fetch them separately using the userId and profileId
  }
}

query GetBusinessProfile($workspaceId: UUID!) @auth(level: USER) {
  businessProfile(first: {where: {workspaceId: {eq: $workspaceId}}}) {
    id
    workspaceId
    name
    industry
    description
    location
    website
    employeeCount
    createdAt
    updatedAt
  }
}

query GetPartnerPreferences($workspaceId: UUID!) @auth(level: USER) {
  partnerPreferences(first: {where: {workspaceId: {eq: $workspaceId}}}) {
    id
    workspaceId
    industries
    locations
    minEmployeeCount
    maxEmployeeCount
    skillsNeeded
    createdAt
    updatedAt
  }
}

query GetWorkspaceInvitations($workspaceId: UUID!) @auth(level: USER) {
  workspaceInvitations(where: {workspaceId: {eq: $workspaceId}}) {
    id
    workspaceId
    email
    role
    invitedBy
    status
    createdAt
    expiresAt
  }
}

query GetPendingInvitationsByEmail($email: String!) @auth(level: USER) {
  workspaceInvitations(where: {
    _and: [
      {email: {eq: $email}},
      {status: {eq: "pending"}}
    ]
  }) {
    id
    workspaceId
    email
    role
    invitedBy
    status
    createdAt
    expiresAt
    # Note: We can't directly query the workspace relationship
    # We'll need to fetch the workspace separately using the workspaceId
  }
}
