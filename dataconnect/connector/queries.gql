# User queries

query GetAllUsers @auth(level: USER) {
  users {
    id
    email
    displayName
    photoUrl
    createdAt
    updatedAt
  }
}

query GetCurrentUser @auth(level: USER) {
  user(key: {id_expr: "auth.uid"}) {
    id
    email
    displayName
    photoUrl
    createdAt
    updatedAt
  }
}

# Vector search queries
query SearchProfilesByBio($searchText: String!, $limit: Int = 5) @auth(level: USER) {
  profiles_bioEmbedding_similarity(
    compare_embed: {model: "textembedding-gecko@003", text: $searchText},
    method: COSINE,
    limit: $limit
  ) {
    id
    userId
    name
    bio
    skills
    interests
    avatarUrl
  }
}

query SearchBusinessProfilesByDescription($searchText: String!, $limit: Int = 5) @auth(level: USER) {
  businessProfiles_descriptionEmbedding_similarity(
    compare_embed: {model: "textembedding-gecko@003", text: $searchText},
    method: COSINE,
    limit: $limit
  ) {
    id
    workspaceId
    name
    industry
    description
    location
    website
    employeeCount
  }
}

query MatchProfileToBusinesses($profileId: UUID!, $limit: Int = 5) @auth(level: USER) {
  profile(key: {id: $profileId}) {
    id
    name
    bio
    bioEmbedding
  }
}

query BusinessProfilesBySimilarity($bioEmbedding: Vector!, $limit: Int = 5) @auth(level: USER) {
  businessProfiles_descriptionEmbedding_similarity(
    compare: $bioEmbedding,
    method: COSINE,
    limit: $limit
  ) {
    id
    workspaceId
    name
    industry
    description
    location
    website
    employeeCount
  }
}

query MatchBusinessToProfiles($businessProfileId: UUID!, $limit: Int = 5) @auth(level: USER) {
  businessProfile(key: {id: $businessProfileId}) {
    id
    name
    description
    descriptionEmbedding
  }
}

query ProfilesBySimilarity($descriptionEmbedding: Vector!, $limit: Int = 5) @auth(level: USER) {
  profiles_bioEmbedding_similarity(
    compare: $descriptionEmbedding,
    method: COSINE,
    limit: $limit
  ) {
    id
    userId
    name
    bio
    skills
    interests
    avatarUrl
  }
}

query SearchPartnerPreferences($searchText: String!, $limit: Int = 5) @auth(level: USER) {
  partnerPreferencess_combinedEmbedding_similarity(
    compare_embed: {model: "textembedding-gecko@003", text: $searchText},
    method: COSINE,
    limit: $limit
  ) {
    id
    workspaceId
    industries
    locations
    minEmployeeCount
    maxEmployeeCount
    skillsNeeded
  }
}

query GetUser($id: String!) @auth(level: USER) {
  user(key: {id: $id}) {
    id
    email
    displayName
    photoUrl
    createdAt
    updatedAt
  }
}

query GetUserProfiles @auth(level: USER) {
  profiles(where: {userId: {eq_expr: "auth.uid"}}) {
    id
    userId
    name
    bio
    avatarUrl
    skills
    interests
    isDefault
    createdAt
    updatedAt
  }
}

# Workspace queries
query GetUserWorkspaces($userId: String!) @auth(level: USER) {
  workspaceUsers(where: { user: { id: { eq: $userId } } }) {
    workspace {
      id
      name
      description
      logoUrl
      createdBy
      createdAt
      updatedAt
    }
  }
}

query GetWorkspace($id: UUID!) @auth(level: USER) {
  workspace(key: {id: $id}) {
    id
    name
    description
    logoUrl
    createdBy
    createdAt
    updatedAt
  }
}

# GetWorkspaceMembers (Reverted to fetch direct IDs)
query GetWorkspaceMembers($workspaceId: UUID!) @auth(level: USER) {
  workspaceMembers(where: {workspaceId: {eq: $workspaceId}}) {
    role
    joinedAt
    # DataConnect doesn't generate nested user/profile here,
    # fetch IDs and resolve client-side if needed.
    userId 
    profileId # Optional
  }
}

query GetBusinessProfile($workspaceId: UUID!) @auth(level: USER) {
  businessProfile(first: {where: {workspaceId: {eq: $workspaceId}}}) {
    id
    workspaceId
    name
    industry
    description
    location
    website
    employeeCount
    createdAt
    updatedAt
  }
}

query GetPartnerPreferences($workspaceId: UUID!) @auth(level: USER) {
  partnerPreferences(first: {where: {workspaceId: {eq: $workspaceId}}}) {
    id
    workspaceId
    industries
    locations
    minEmployeeCount
    maxEmployeeCount
    skillsNeeded
    createdAt
    updatedAt
  }
}

query GetWorkspaceInvitations($workspaceId: UUID!) @auth(level: USER) {
  workspaceInvitations(where: {workspaceId: {eq: $workspaceId}}) {
    id
    workspaceId
    email
    role
    invitedBy
    status
    createdAt
    expiresAt
  }
}

# GetPendingInvitations (Reverted to fetch direct IDs)
query GetPendingInvitations($email: String!) @auth(level: USER) {
  workspaceInvitations(where: {
    _and: [
      {email: {eq: $email}},
      {status: {eq: "pending"}}
    ]
  }) {
    id
    email
    role
    status
    createdAt
    expiresAt
    # DataConnect doesn't generate nested workspace/inviter here,
    # fetch IDs and resolve client-side if needed.
    workspaceId
    invitedBy # User ID of the inviter
  }
}
